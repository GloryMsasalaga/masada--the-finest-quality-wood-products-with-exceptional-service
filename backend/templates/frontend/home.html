{% extends 'frontend/base.html' %}
{% load static %}

{% block title %}Masada - From Forest to Furniture{% endblock %}

{% block content %}
<!-- Parallax Hero Section -->
<div class="parallax-container">
    <!-- Layer 1: Tree -->
    <div class="parallax-layer layer-tree" id="layer-tree">
        <img src="{% static 'images/150779_Katana_Ai-Photo-Library-V2_Image-6_Low-Res.webp' %}" alt="Forest"
            class="parallax-bg-img">
        <div class="layer-overlay"></div>
        <div class="layer-content">
            <h1>Masada Intertrade Company</h1>
            <p>Built on trust and excellence.</p>
        </div>
    </div>

    <!-- Layer 2: Cut Tree (Stump/Logs) -->
    <div class="parallax-layer layer-cut" id="layer-cut">
        <img src="{% static 'images/construction-inventory-software-lumber-1024x683.jpg' %}" alt="Raw Timber"
            class="parallax-bg-img">
        <div class="layer-overlay"></div>
        <div class="layer-content">
            <h1>Raw Material</h1>
            <p>Premium Quality Timber</p>
        </div>
    </div>

    <!-- Layer 3: Furniture -->
    <div class="parallax-layer layer-furniture" id="layer-furniture">
        <img src="{% static 'images/shutterstock_189324260-scaled.jpg' %}" alt="Wood Furniture" class="parallax-bg-img">
        <div class="layer-overlay"></div>
        <div class="layer-content">
            <h1>Masterpiece</h1>
            <p>Exquisite Wood Furniture</p>
            <div class="mt-4">
                <a href="{% url 'shop' %}" class="btn btn-glow me-3">Shop Now</a>
                <a href="#features" class="btn btn-outline-light btn-lg">Learn More</a>
            </div>
        </div>
    </div>

    <div class="scroll-indicator">
        <div class="mouse">
            <div class="wheel"></div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="content-section position-relative">

    <!-- Features Section -->
    <section id="features" class="py-5">
        <div class="container minimized-container">
            <div class="row text-center mb-5">
                <div class="col-lg-12 section-header">
                    <h2 class="display-5 fw-bold mb-3">Why Choose Masada?</h2>
                    <p class="lead text-muted">We provide the finest quality wood products with exceptional service</p>
                    <div class="separator mx-auto"></div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-4 feature-box-wrapper">
                    <div class="card h-100 text-center p-4 feature-card glass-effect">
                        <div class="card-body">
                            <div class="icon-wrapper mb-4">
                                <i class="fas fa-award text-primary"></i>
                            </div>
                            <h4>Premium Quality</h4>
                            <p class="text-muted">Hand-selected wood products that meet the highest quality standards
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 feature-box-wrapper">
                    <div class="card h-100 text-center p-4 feature-card glass-effect">
                        <div class="card-body">
                            <div class="icon-wrapper mb-4">
                                <i class="fas fa-truck text-primary"></i>
                            </div>
                            <h4>Fast Delivery</h4>
                            <p class="text-muted">Quick and reliable delivery service to your doorstep</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 feature-box-wrapper">
                    <div class="card h-100 text-center p-4 feature-card glass-effect">
                        <div class="card-body">
                            <div class="icon-wrapper mb-4">
                                <i class="fas fa-headset text-primary"></i>
                            </div>
                            <h4>Expert Support</h4>
                            <p class="text-muted">Professional guidance to help you choose the right wood for your
                                project</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Categories -->
    <section class="py-5 bg-light position-relative overflow-hidden">
        <div class="bg-decoration-circle"></div>
        <div class="container position-relative z-index-1 minimized-container">
            <div class="row text-center mb-5">
                <div class="col-lg-12 section-header">
                    <h2 class="display-5 fw-bold mb-3">Browse by Category</h2>
                    <p class="lead text-muted">Find the perfect wood type for your project</p>
                    <div class="separator mx-auto"></div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-3 category-wrapper">
                    <div class="card category-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="category-icon-box mb-3 bg-primary-subtle rounded-circle mx-auto">
                                <i class="fas fa-tree text-primary"></i>
                            </div>
                            <h5>Hardwood</h5>
                            <p class="text-muted mb-3 small">Oak, Maple, Cherry, and more premium hardwoods</p>
                            <a href="{% url 'shop' %}?type=Hardwood"
                                class="btn btn-outline-primary btn-sm rounded-pill stretched-link">Browse</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 category-wrapper">
                    <div class="card category-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="category-icon-box mb-3 bg-success-subtle rounded-circle mx-auto">
                                <i class="fas fa-seedling text-success"></i>
                            </div>
                            <h5>Softwood</h5>
                            <p class="text-muted mb-3 small">Pine, Fir, Cedar for construction projects</p>
                            <a href="{% url 'shop' %}?type=Softwood"
                                class="btn btn-outline-success btn-sm rounded-pill stretched-link">Browse</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 category-wrapper">
                    <div class="card category-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="category-icon-box mb-3 bg-warning-subtle rounded-circle mx-auto">
                                <i class="fas fa-layer-group text-warning"></i>
                            </div>
                            <h5>Plywood</h5>
                            <p class="text-muted mb-3 small">Various grades and thicknesses available</p>
                            <a href="{% url 'shop' %}?type=Plywood"
                                class="btn btn-outline-warning btn-sm rounded-pill stretched-link">Browse</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 category-wrapper">
                    <div class="card category-card h-100 border-0 shadow-sm">
                        <div class="card-body text-center p-4">
                            <div class="category-icon-box mb-3 bg-info-subtle rounded-circle mx-auto">
                                <i class="fas fa-hammer text-info"></i>
                            </div>
                            <h5>Lumber</h5>
                            <p class="text-muted mb-3 small">Construction grade lumber in various sizes</p>
                            <a href="{% url 'shop' %}?type=Lumber"
                                class="btn btn-outline-info btn-sm rounded-pill stretched-link">Browse</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="py-5">
        <div class="container">
            <div class="row text-center mb-5">
                <div class="col-lg-12 section-header">
                    <h2 class="display-5 fw-bold mb-3">Featured Products</h2>
                    <p class="lead text-muted">Check out our most popular wood products</p>
                    <div class="separator mx-auto"></div>
                </div>
            </div>

            <div class="row g-4">
                {% for product in featured_products %}
                <div class="col-lg-4 col-md-6 product-wrapper">
                    <div class="card product-card h-100 border-0 shadow-lg overflow-hidden">
                        <div class="position-relative product-img-container">
                            <img src="https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=400&h=300&fit=crop&crop=center"
                                class="card-img-top" alt="{{ product.ProductName }}">
                            <div class="product-overlay">
                                <button onclick="addToCart('{{ product.product_id }}')"
                                    class="btn btn-light btn-circle btn-glow-white">
                                    <i class="fas fa-cart-plus"></i>
                                </button>
                                <a href="{% url 'product_detail' product.product_id %}"
                                    class="btn btn-light btn-circle btn-glow-white ms-2">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                            {% if product.stock_quantity < 10 %} <span
                                class="badge bg-warning position-absolute top-0 end-0 m-3 shadow-sm">Limited
                                Stock</span>
                                {% endif %}
                        </div>
                        <div class="card-body d-flex flex-column p-4">
                            <div class="mb-2">
                                <span class="badge bg-secondary bg-opacity-10 text-secondary">{{ product.ProductType
                                    }}</span>
                                <span class="badge bg-info bg-opacity-10 text-info ms-1">{{ product.grade }}</span>
                            </div>
                            <h5 class="card-title fw-bold">{{ product.ProductName }}</h5>
                            <p class="card-text text-muted flex-grow-1 small">{{ product.description|truncatewords:15 }}
                            </p>
                            <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                                <div>
                                    <span class="h4 text-primary fw-bold mb-0">${{ product.Price_per_unit }}</span>
                                    <small class="text-muted">/unit</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center">
                    <p class="lead text-muted">No products available at the moment.</p>
                    <a href="{% url 'shop' %}" class="btn btn-primary btn-glow">Browse All Products</a>
                </div>
                {% endfor %}
            </div>

            {% if featured_products %}
            <div class="text-center mt-5">
                <a href="{% url 'shop' %}" class="btn btn-primary btn-lg btn-glow px-5 rounded-pill">
                    View All Products <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-5 bg-primary text-white position-relative overflow-hidden cta-section">
        <div class="cta-bg-pattern"></div>
        <div class="container position-relative z-index-1">
            <div class="row justify-content-center text-center">
                <div class="col-lg-8 cta-content">
                    <h2 class="display-4 fw-bold mb-4">Ready to Start Your Project?</h2>
                    <p class="lead mb-5 opacity-75">Get premium quality wood delivered to your doorstep. Join thousands
                        of satisfied customers!</p>
                    <div class="cta-buttons">
                        {% if not request.session.customer_id %}
                        <a href="{% url 'signup' %}"
                            class="btn btn-light btn-lg me-3 btn-glow-white text-primary fw-bold">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </a>
                        {% endif %}
                        <a href="{% url 'shop' %}" class="btn btn-outline-light btn-lg btn-glow-white">
                            <i class="fas fa-shopping-bag me-2"></i>Shop Now
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_css %}
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        gsap.registerPlugin(ScrollTrigger);

        // --- Parallax Layer Animation ---
        ScrollTrigger.create({
            trigger: ".parallax-container",
            start: "top top",
            end: "+=3000", // Scroll distance
            pin: true,
            scrub: 1,
            onUpdate: (self) => {
                const progress = self.progress;

                const layerTree = document.getElementById('layer-tree');
                const layerCut = document.getElementById('layer-cut');
                const layerFurniture = document.getElementById('layer-furniture');

                // Layer 1 (Tree) -> Layer 2 (Cut)
                if (progress < 0.33) {
                    gsap.to(layerTree, { opacity: 1, scale: 1 + progress, duration: 0 });
                    gsap.to(layerCut, { opacity: 0, duration: 0 });
                    gsap.to(layerFurniture, { opacity: 0, duration: 0 });
                } else if (progress < 0.66) {
                    // Transition Tree -> Cut
                    const p = (progress - 0.33) * 3; // 0 to 1
                    gsap.to(layerTree, { opacity: 1 - p, scale: 1.33 + p, duration: 0 });
                    gsap.to(layerCut, { opacity: p, scale: 1 + (p * 0.1), duration: 0 });
                    gsap.to(layerFurniture, { opacity: 0, duration: 0 });
                } else {
                    // Transition Cut -> Furniture
                    const p = (progress - 0.66) * 3; // 0 to 1
                    gsap.to(layerTree, { opacity: 0, duration: 0 });
                    gsap.to(layerCut, { opacity: 1 - p, scale: 1.1 + p, duration: 0 });
                    gsap.to(layerFurniture, { opacity: p, scale: 1 + (p * 0.1), duration: 0 });
                }
            }
        });

        // --- Content Reveal ---
        gsap.from(".content-section", {
            scrollTrigger: {
                trigger: ".content-section",
                start: "top 80%",
            },
            y: 100,
            opacity: 0,
            duration: 1
        });

        // --- Crazy Scroll Animations for Features ---
        gsap.utils.toArray('.feature-box-wrapper').forEach((box, i) => {
            gsap.from(box, {
                scrollTrigger: {
                    trigger: box,
                    start: "top 85%",
                    toggleActions: "play none none reverse"
                },
                duration: 0.8,
                y: 100,
                rotation: i % 2 === 0 ? -10 : 10, // Tilt left/right
                opacity: 0,
                scale: 0.8,
                ease: "elastic.out(1, 0.5)",
                delay: i * 0.2
            });
        });

        // --- Section Headers Reveal ---
        gsap.utils.toArray('.section-header').forEach(header => {
            gsap.from(header, {
                scrollTrigger: {
                    trigger: header,
                    start: "top 80%",
                },
                duration: 1,
                y: 50,
                opacity: 0,
                ease: "power3.out"
            });
        });

        // --- Category Cards Stagger ---
        gsap.from(".category-wrapper", {
            scrollTrigger: {
                trigger: ".category-wrapper",
                start: "top 85%",
            },
            duration: 0.8,
            y: 50,
            opacity: 0,
            stagger: 0.1,
            ease: "power2.out"
        });

        // --- Product Cards 3D Flip Effect ---
        gsap.utils.toArray('.product-wrapper').forEach((product, i) => {
            gsap.from(product, {
                scrollTrigger: {
                    trigger: product,
                    start: "top 90%",
                },
                duration: 1,
                opacity: 0,
                rotationX: 45,
                y: 100,
                transformOrigin: "top center",
                ease: "power3.out",
                stagger: 0.2
            });
        });
    });
</script>
{% endblock %}